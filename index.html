<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Roster Management System - Shriajj Pty Ltd</title>
    <meta name="description" content="Professional staff roster management system for Shriajj Pty Ltd. Manage employee schedules, locations, and real-time synchronization across multiple devices.">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Staff Roster Management System - Shriajj Pty Ltd">
    <meta property="og:description" content="Comprehensive staff scheduling solution with real-time sync and multi-location support">
    <meta property="og:type" content="website">
    
    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        :root {
            --background: hsl(0, 0%, 100%);
            --foreground: hsl(222.2, 84%, 4.9%);
            --card: hsl(0, 0%, 100%);
            --card-foreground: hsl(222.2, 84%, 4.9%);
            --popover: hsl(0, 0%, 100%);
            --popover-foreground: hsl(222.2, 84%, 4.9%);
            --primary: hsl(221.2, 83.2%, 53.3%);
            --primary-foreground: hsl(210, 40%, 98%);
            --secondary: hsl(210, 40%, 96%);
            --secondary-foreground: hsl(222.2, 84%, 4.9%);
            --muted: hsl(210, 40%, 96%);
            --muted-foreground: hsl(215.4, 16.3%, 46.9%);
            --accent: hsl(210, 40%, 96%);
            --accent-foreground: hsl(222.2, 84%, 4.9%);
            --destructive: hsl(0, 84.2%, 60.2%);
            --destructive-foreground: hsl(210, 40%, 98%);
            --border: hsl(214.3, 31.8%, 91.4%);
            --input: hsl(214.3, 31.8%, 91.4%);
            --ring: hsl(221.2, 83.2%, 53.3%);
            --success: hsl(142.1, 76.2%, 36.3%);
            --warning: hsl(38, 92%, 50%);
            --error: hsl(0, 84.2%, 60.2%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .min-h-screen {
            min-height: 100vh;
        }

        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .grid {
            display: grid;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .space-x-1 > * + * {
            margin-left: 0.25rem;
        }

        .space-x-2 > * + * {
            margin-left: 0.5rem;
        }

        .space-x-4 > * + * {
            margin-left: 1rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .w-full {
            width: 100%;
        }

        .max-w-md {
            max-width: 28rem;
        }

        .max-w-7xl {
            max-width: 80rem;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .p-8 {
            padding: 2rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-center {
            text-align: center;
        }

        .text-white {
            color: white;
        }

        .text-gray-500 {
            color: hsl(220, 8.9%, 46.1%);
        }

        .text-gray-600 {
            color: hsl(215.4, 16.3%, 46.9%);
        }

        .text-gray-700 {
            color: hsl(215.3, 19.3%, 34.5%);
        }

        .text-gray-900 {
            color: hsl(222.2, 84%, 4.9%);
        }

        .text-primary {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
        }

        .text-error {
            color: var(--error);
        }

        .bg-white {
            background-color: white;
        }

        .bg-gray-50 {
            background-color: hsl(210, 40%, 98%);
        }

        .bg-primary {
            background-color: var(--primary);
        }

        .bg-success {
            background-color: var(--success);
        }

        .bg-error {
            background-color: var(--error);
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }

        .border {
            border-width: 1px;
            border-style: solid;
            border-color: var(--border);
        }

        .border-b {
            border-bottom-width: 1px;
            border-bottom-style: solid;
            border-bottom-color: var(--border);
        }

        .border-gray-200 {
            border-color: hsl(220, 13%, 91%);
        }

        .border-gray-300 {
            border-color: hsl(212, 12%, 84%);
        }

        .border-transparent {
            border-color: transparent;
        }

        .border-primary {
            border-color: var(--primary);
        }

        .border-b-2 {
            border-bottom-width: 2px;
        }

        /* Form Elements */
        input, select, textarea {
            appearance: none;
            border-radius: 0.375rem;
            border: 1px solid var(--border);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px hsl(221.2, 83.2%, 53.3%, 0.1);
        }

        /* Buttons */
        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1rem;
        }

        .btn-primary:hover {
            background-color: hsl(221.2, 83.2%, 48.3%);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--secondary-foreground);
            border: 1px solid var(--border);
            padding: 0.75rem 1rem;
        }

        .btn-secondary:hover {
            background-color: hsl(210, 40%, 94%);
        }

        .btn-ghost {
            background-color: transparent;
            color: var(--foreground);
            padding: 0.5rem;
        }

        .btn-ghost:hover {
            background-color: var(--muted);
        }

        .btn-action {
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 200px;
        }

        .btn-purple {
            background-color: #8b5cf6;
            color: white;
        }

        .btn-purple:hover {
            background-color: #7c3aed;
            transform: translateY(-1px);
        }

        .btn-blue {
            background-color: #3b82f6;
            color: white;
        }

        .btn-blue:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        .btn-green {
            background-color: #10b981;
            color: white;
        }

        .btn-green:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }

        /* Grid Layout */
        .roster-grid {
            display: grid;
            grid-template-columns: 200px repeat(7, minmax(140px, 1fr));
            gap: 1px;
            background-color: var(--border);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .roster-cell {
            background-color: white;
            min-height: 120px;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 0.5rem;
            position: relative;
            flex-direction: column;
            gap: 0.25rem;
        }

        .roster-cell.header {
            background-color: var(--muted);
            font-weight: 600;
            font-size: 0.875rem;
            align-items: center;
            justify-content: center;
        }

        .roster-cell.location-name {
            background-color: var(--card);
            justify-content: flex-start;
            align-items: flex-start;
            padding: 1rem;
            font-weight: 600;
        }

        .shift-card {
            background-color: hsl(221.2, 83.2%, 95%);
            border: 1px solid var(--primary);
            border-radius: 0.375rem;
            padding: 0.5rem;
            margin: 0;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .shift-card:hover {
            background-color: hsl(221.2, 83.2%, 90%);
        }

        .shift-card.selected {
            background-color: var(--primary);
            color: white;
        }

        .shift-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .shift-form input {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }

        /* Tab Navigation */
        .tab-nav {
            background-color: white;
            border-bottom: 1px solid var(--border);
        }

        .tab-button {
            padding: 1rem;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            color: var(--muted-foreground);
            transition: all 0.15s ease-in-out;
            background: none;
        }

        .tab-button.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-button:hover {
            color: var(--foreground);
        }

        /* Connection Status */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-online {
            background-color: var(--success);
        }

        .status-offline {
            background-color: var(--error);
        }

        .status-syncing {
            background-color: var(--warning);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .roster-grid {
                grid-template-columns: 120px repeat(7, 60px);
                font-size: 0.75rem;
                overflow-x: auto;
            }
            
            .roster-cell {
                min-height: 60px;
                padding: 0.25rem;
            }

            .roster-cell.employee-name {
                padding: 0.5rem;
            }

            .shift-card {
                font-size: 0.625rem;
                padding: 0.25rem;
            }

            .max-w-7xl {
                padding: 0 1rem;
            }

            .space-x-4 > * + * {
                margin-left: 0.5rem;
            }

            .flex-col-mobile {
                flex-direction: column;
            }

            .space-y-mobile > * + * {
                margin-top: 0.5rem;
            }
        }

        /* Loading States */
        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Utility Classes */
        .w-4 { width: 1rem; }
        .h-4 { height: 1rem; }
        .w-5 { width: 1.25rem; }
        .h-5 { height: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .h-6 { height: 1.5rem; }
        .w-8 { width: 2rem; }
        .h-8 { height: 2rem; }

        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mr-2 { margin-right: 0.5rem; }
        .ml-4 { margin-left: 1rem; }

        .relative { position: relative; }
        .absolute { position: absolute; }
        .inset-y-0 { top: 0; bottom: 0; }
        .right-0 { right: 0; }
        .left-0 { left: 0; }
        .pr-3 { padding-right: 0.75rem; }
        .pl-3 { padding-left: 0.75rem; }
        .pl-10 { padding-left: 2.5rem; }

        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }

        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }

        .transition-all { transition: all 0.15s ease-in-out; }
        .transition-colors { transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out; }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full space-y-6 p-8 bg-white rounded-xl shadow-lg">
            <div class="text-center">
                <div class="flex justify-center mb-4">
                    <div class="p-3 bg-primary rounded-full">
                        <i data-lucide="building" class="w-8 h-8 text-white"></i>
                    </div>
                </div>
                <h2 id="companyName" class="text-3xl font-bold text-gray-900">Shriajj Pty Ltd</h2>
                <p id="systemTitle" class="text-gray-600 mt-2">Staff Roster Management System</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                        <div class="mt-2 relative">
                            <input 
                                id="username" 
                                name="username" 
                                type="text" 
                                required 
                                class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg"
                                placeholder="Enter your username"
                            >
                            <i data-lucide="user" class="w-5 h-5 text-gray-400 absolute left-3 inset-y-0" style="top: 50%; transform: translateY(-50%);"></i>
                        </div>
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <div class="mt-2 relative">
                            <input 
                                id="password" 
                                name="password" 
                                type="password" 
                                required 
                                class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg"
                                placeholder="Enter your password"
                            >
                            <i data-lucide="lock" class="w-5 h-5 text-gray-400 absolute left-3 inset-y-0" style="top: 50%; transform: translateY(-50%);"></i>
                            <button 
                                type="button" 
                                id="togglePassword"
                                class="absolute right-3 text-gray-400 hover:text-gray-600 cursor-pointer"
                                style="top: 50%; transform: translateY(-50%); z-index: 10;"
                            >
                                <i data-lucide="eye-off" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input 
                            id="rememberPassword" 
                            name="rememberPassword" 
                            type="checkbox" 
                            class="h-4 w-4 text-primary border-gray-300 rounded"
                        >
                        <label for="rememberPassword" class="ml-2 block text-sm text-gray-700">
                            Remember password
                        </label>
                    </div>
                </div>

                <div id="loginError" class="hidden text-error text-sm"></div>

                <button 
                    type="submit" 
                    class="w-full btn-primary"
                >
                    Sign In
                </button>
            </form>

            <div class="text-center">
                <div class="flex items-center justify-center space-x-2">
                    <div id="connectionStatus" class="status-indicator status-offline"></div>
                    <span id="connectionText" class="text-sm text-gray-500">Connecting...</span>
                </div>
            </div>

            <div class="text-center text-xs text-gray-500">
                <p>Developed by Vrushali Hinge</p>
                <p>¬© 2025 Shriajj Pty Ltd. All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="p-2 bg-primary rounded-lg">
                            <i data-lucide="calendar" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-semibold text-gray-900">Staff Roster Management</h1>
                            <p class="text-sm text-gray-600">Shriajj Pty Ltd</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div id="syncStatus" class="status-indicator status-syncing"></div>
                            <span id="syncText" class="text-sm text-gray-600">Syncing...</span>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <i data-lucide="user" class="w-4 h-4 text-gray-500"></i>
                            <span id="currentUserDisplay" class="text-sm text-gray-700"></span>
                        </div>
                        
                        <button id="logoutBtn" class="btn-ghost">
                            <i data-lucide="log-out" class="w-4 h-4 mr-2"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tab-nav">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex space-x-8">
                    <button data-tab="roster" class="tab-button active">
                        <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                        Roster
                    </button>
                    <button data-tab="employees" class="tab-button">
                        <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                        Employees
                    </button>
                    <button data-tab="locations" class="tab-button">
                        <i data-lucide="building" class="w-4 h-4 mr-2"></i>
                        Locations
                    </button>
                    <button data-tab="reports" class="tab-button">
                        <i data-lucide="bar-chart-3" class="w-4 h-4 mr-2"></i>
                        Reports
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Roster Tab -->
            <div id="rosterTab" class="tab-content">
                <div class="space-y-6">
                    <!-- Week Navigation -->
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-4">
                            <button id="prevWeek" class="btn-ghost">
                                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            </button>
                            <h2 id="currentWeekDisplay" class="text-lg font-semibold">Aug 3-9, 2025</h2>
                            <button id="nextWeek" class="btn-ghost">
                                <i data-lucide="chevron-right" class="w-4 h-4"></i>
                            </button>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button id="editModeBtn" class="btn-secondary">
                                <i data-lucide="edit" class="w-4 h-4 mr-2"></i>
                                Edit
                            </button>
                            <button id="saveModeBtn" class="btn-primary hidden">
                                <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                Save
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-center items-center space-x-4 mt-6">
                        <button id="previousWeekBtn" class="btn-action btn-purple">
                            <i data-lucide="upload" class="w-4 h-4 mr-2"></i>
                            Previous Week
                        </button>
                        <button id="downloadCombinedBtn" class="btn-action btn-blue">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            Download Combined Roster
                        </button>
                        <button id="exportEmployeesBtn" class="btn-action btn-green">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            Export for Employees
                        </button>
                    </div>

                    <!-- Edit Mode Notice -->
                    <div id="editModeNotice" class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i data-lucide="info" class="w-5 h-5 text-blue-400"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>View Mode:</strong> Click the "Edit" button above to add or modify shifts.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Roster Grid -->
                    <div class="overflow-x-auto">
                        <div id="rosterGrid" class="roster-grid">
                            <!-- Grid will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Weekly Hours Summary by Pay Rate -->
                    <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Weekly Hours Summary by Pay Rate</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="p-2 text-left font-semibold text-gray-700 border-r">Employee</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-blue-50">Regular</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-orange-50">Overtime</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-indigo-50">Saturday</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-purple-50">Sunday</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-red-50">PH Work</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-green-50">AL</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-yellow-50">SL</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-pink-50">PHL</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-cyan-50">Mandatory (24h)</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 border-r bg-gray-50">Remaining Reg</th>
                                        <th class="p-2 text-center font-semibold text-gray-700 bg-emerald-50">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="weeklySummaryTableBody">
                                    <!-- Table rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employees Tab -->
            <div id="employeesTab" class="tab-content hidden">
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Employee Management</h2>
                        <button id="addEmployeeBtn" class="btn-primary">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Employee
                        </button>
                    </div>
                    
                    <div id="employeesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Employee cards will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Locations Tab -->
            <div id="locationsTab" class="tab-content hidden">
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Location Management</h2>
                        <button id="addLocationBtn" class="btn-primary">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Location
                        </button>
                    </div>
                    
                    <div id="locationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Location cards will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content hidden">
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Weekly Reports</h2>
                        <div class="flex items-center space-x-2">
                            <button id="exportReport" class="btn-secondary">
                                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                Export
                            </button>
                            <button id="refreshReport" class="btn-primary">
                                <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Hours Summary by Pay Rate -->
                    <div class="bg-white rounded-lg border p-6">
                        <h3 class="text-lg font-semibold mb-4">Hours Summary by Pay Rate</h3>
                        <div class="overflow-x-auto">
                            <table id="payRateTable" class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="border border-gray-200 px-3 py-2 text-left font-medium">Employee</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-blue-600">Regular</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-red-600">Overtime</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-blue-600">Saturday</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-purple-600">Sunday</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-red-600">PH Work</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-green-600">AL</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-yellow-600">SL</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-pink-600">PHL</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-cyan-600">Mandatory (24h)</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-gray-600">Remaining Reg</th>
                                        <th class="border border-gray-200 px-3 py-2 text-center font-medium text-green-700">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="payRateTableBody">
                                    <!-- Table rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="reportsContent" class="space-y-4">
                        <!-- Additional reports will be populated here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Shift Edit Modal -->
    <div id="shiftModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">Edit Shift</h3>
                    <button id="closeModal" class="btn-ghost">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
                
                <form id="shiftForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Employee</label>
                            <select id="shiftEmployee" class="w-full mt-1">
                                <!-- Options populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Location</label>
                            <select id="shiftLocation" class="w-full mt-1">
                                <!-- Options populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Start Time</label>
                            <input id="shiftStartTime" type="time" class="w-full mt-1" value="09:00">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">End Time</label>
                            <input id="shiftEndTime" type="time" class="w-full mt-1" value="17:00">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Leave Type</label>
                        <select id="shiftLeaveType" class="w-full mt-1">
                            <option value="">No Leave</option>
                            <option value="annual">Annual Leave</option>
                            <option value="sick">Sick Leave</option>
                            <option value="public">Public Holiday</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Notes</label>
                        <textarea id="shiftNotes" rows="3" class="w-full mt-1" placeholder="Additional notes..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="deleteShift" class="btn-secondary text-error">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                            Delete
                        </button>
                        <button type="submit" class="btn-primary">
                            <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                            Save Shift
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Application State Management
        let appState = {
            // Authentication
            isLoggedIn: false,
            currentUser: '',
            
            // UI State
            activeTab: 'roster',
            editMode: false,
            currentWeekStart: new Date(2025, 7, 3), // Aug 3, 2025
            showPassword: false,
            rememberPassword: false,
            
            // Network State
            isOnline: navigator.onLine,
            syncStatus: 'synced', // 'synced', 'syncing', 'offline'
            
            // Configuration
            appConfig: {
                companyName: "Shriajj Pty Ltd",
                systemTitle: "Staff Roster Management System",
                locationId: "main",
                timezone: "Australia/Melbourne",
                developer: "Vrushali Hinge",
                users: {
                    admin: 'shriajj2025',
                    manager: 'manager123',
                    supervisor: 'super2025'
                }
            },
            
            // Data
            employees: ['Bhanush', 'Girish', 'Aravind', 'Vansh', 'Kashish', 'Sonam', 'Tejal', 'Anshul', 'Matt', 'Aswin'],
            locations: ['Caroline Springs', 'Werribee Plaza', 'Point Cook', 'Geelong', 'Woodgrove'],
            allRosterData: {},
            publicHolidays: {},
            
            // Modal state
            currentEditingShift: null,
            currentEditingEmployee: null,
            currentEditingLocation: null
        };

        // Database Configuration - loaded from server
        let DATABASE_CONFIG = {
            supabase: {
                url: 'https://uuorqbugdhfoikylbxdz.supabase.co',
                key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1b3JxYnVnZGhmb2lreWxieGR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MzQ4NDcsImV4cCI6MjA3MDAxMDg0N30.-d7xjLnyFVoVKbruKhVJthHYCFUkkrWlwijDbrKdye4',
                enabled: true
            }
        };

        // Load database configuration from server
        async function loadDatabaseConfig() {
            try {
                const response = await fetch('/api/config');
                if (response.ok) {
                    const config = await response.json();
                    DATABASE_CONFIG = config;
                    console.log('‚úÖ Database configuration loaded from server');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not load database config from server, using defaults:', error);
            }
        }

        // Enhanced Database Service with Supabase Integration
        class DatabaseService {
            constructor() {
                this.isConnected = false;
                this.listeners = new Set();
                this.localCache = JSON.parse(localStorage.getItem('roster-cache') || '{}');
                this.supabase = null;
                this.retryCount = 0;
                this.maxRetries = 3;
            }

            // Initialize Supabase connection
            async initialize(config) {
                try {
                    if (config.supabase?.enabled && window.supabase) {
                        this.supabase = window.supabase.createClient(
                            config.supabase.url,
                            config.supabase.key
                        );
                        
                        // Test connection
                        const { data, error } = await this.supabase
                            .from('rosters')
                            .select('count', { count: 'exact', head: true });
                        
                        if (!error || error.code === 'PGRST116') { // Table doesn't exist is OK
                            this.isConnected = true;
                            console.log('‚úÖ Supabase connected successfully!');
                            await this.initializeTables();
                            this.setupRealtimeSubscriptions();
                            return true;
                        } else {
                            throw error;
                        }
                    }
                    return false;
                } catch (error) {
                    console.error('‚ùå Database connection failed:', error);
                    this.isConnected = false;
                    return false;
                }
            }

            // Initialize required database tables
            async initializeTables() {
                const tables = [
                    {
                        name: 'rosters',
                        schema: `
                            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                            location_id TEXT NOT NULL,
                            week_key TEXT NOT NULL,
                            data JSONB NOT NULL,
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                            UNIQUE(location_id, week_key)
                        `
                    },
                    {
                        name: 'employees',
                        schema: `
                            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                            location_id TEXT NOT NULL,
                            employees JSONB NOT NULL,
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                            UNIQUE(location_id)
                        `
                    },
                    {
                        name: 'locations',
                        schema: `
                            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                            location_id TEXT NOT NULL,
                            locations JSONB NOT NULL,
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                            UNIQUE(location_id)
                        `
                    }
                ];

                for (const table of tables) {
                    try {
                        const { data, error } = await this.supabase
                            .from(table.name)
                            .select('count', { count: 'exact', head: true });
                        
                        if (error && error.code === 'PGRST116') {
                            console.log(`‚ö†Ô∏è Table '${table.name}' doesn't exist. Please create it in Supabase dashboard.`);
                            console.log(`Schema: CREATE TABLE ${table.name} (${table.schema});`);
                        }
                    } catch (error) {
                        console.warn(`Could not verify table ${table.name}:`, error);
                    }
                }
            }

            // Setup real-time subscriptions
            setupRealtimeSubscriptions() {
                if (!this.supabase) return;

                // Subscribe to roster changes
                this.supabase
                    .channel('rosters-changes')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'rosters'
                    }, (payload) => {
                        this.notifyListeners({
                            type: 'roster_updated',
                            payload
                        });
                    })
                    .subscribe();

                // Subscribe to employee changes
                this.supabase
                    .channel('employees-changes')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'employees'
                    }, (payload) => {
                        this.notifyListeners({
                            type: 'employees_updated',
                            payload
                        });
                    })
                    .subscribe();
            }

            // Real-time data operations
            async saveRosterData(locationId, weekKey, data) {
                try {
                    if (this.isConnected && this.supabase) {
                        const { error } = await this.supabase
                            .from('rosters')
                            .upsert({
                                location_id: locationId,
                                week_key: weekKey,
                                data: data,
                                updated_at: new Date().toISOString()
                            });
                        
                        if (!error) {
                            console.log('‚úÖ Roster data saved to Supabase');
                        } else {
                            throw error;
                        }
                    }
                    
                    // Always save to local cache as backup
                    this.localCache[`${locationId}-${weekKey}`] = data;
                    localStorage.setItem('roster-cache', JSON.stringify(this.localCache));
                    
                    // Notify listeners of changes
                    this.notifyListeners({ type: 'roster_updated', locationId, weekKey, data });
                    return true;
                } catch (error) {
                    console.error('‚ùå Failed to save roster data:', error);
                    // Still save to local cache on failure
                    this.localCache[`${locationId}-${weekKey}`] = data;
                    localStorage.setItem('roster-cache', JSON.stringify(this.localCache));
                    return false;
                }
            }

            async getRosterData(locationId, weekKey) {
                try {
                    if (this.isConnected && this.supabase) {
                        const { data, error } = await this.supabase
                            .from('rosters')
                            .select('data')
                            .eq('location_id', locationId)
                            .eq('week_key', weekKey)
                            .single();
                        
                        if (!error && data) {
                            console.log('‚úÖ Roster data loaded from Supabase');
                            return data.data;
                        }
                    }
                    
                    // Fallback to local cache
                    const cached = this.localCache[`${locationId}-${weekKey}`];
                    if (cached) {
                        console.log('üì± Using cached roster data');
                    }
                    return cached || null;
                } catch (error) {
                    console.error('‚ùå Failed to fetch roster data:', error);
                    return this.localCache[`${locationId}-${weekKey}`] || null;
                }
            }

            async saveEmployees(locationId, employees) {
                try {
                    if (this.isConnected && this.supabase) {
                        const { error } = await this.supabase
                            .from('employees')
                            .upsert({
                                location_id: locationId,
                                employees: employees,
                                updated_at: new Date().toISOString()
                            });
                        
                        if (!error) {
                            console.log('‚úÖ Employees saved to Supabase');
                        } else {
                            throw error;
                        }
                    }
                    
                    this.localCache[`${locationId}-employees`] = employees;
                    localStorage.setItem('roster-cache', JSON.stringify(this.localCache));
                    this.notifyListeners({ type: 'employees_updated', locationId, employees });
                    return true;
                } catch (error) {
                    console.error('‚ùå Failed to save employees:', error);
                    this.localCache[`${locationId}-employees`] = employees;
                    localStorage.setItem('roster-cache', JSON.stringify(this.localCache));
                    return false;
                }
            }

            async getEmployees(locationId) {
                try {
                    if (this.isConnected && this.supabase) {
                        const { data, error } = await this.supabase
                            .from('employees')
                            .select('employees')
                            .eq('location_id', locationId)
                            .single();
                        
                        if (!error && data) {
                            console.log('‚úÖ Employees loaded from Supabase');
                            return data.employees;
                        }
                    }
                    
                    const cached = this.localCache[`${locationId}-employees`];
                    if (cached) {
                        console.log('üì± Using cached employees');
                    }
                    return cached || null;
                } catch (error) {
                    console.error('‚ùå Failed to fetch employees:', error);
                    return this.localCache[`${locationId}-employees`] || null;
                }
            }

            // Real-time listeners for live updates
            onDataChange(callback) {
                this.listeners.add(callback);
                return () => this.listeners.delete(callback);
            }

            notifyListeners(change) {
                this.listeners.forEach(callback => callback(change));
            }

            // Connection status
            getConnectionStatus() {
                return this.isConnected;
            }

            // Manual sync for offline changes
            async syncOfflineChanges() {
                if (!this.isConnected) return false;
                
                try {
                    console.log('üîÑ Syncing offline changes...');
                    // Implementation for syncing offline changes
                    return true;
                } catch (error) {
                    console.error('‚ùå Failed to sync offline changes:', error);
                    return false;
                }
            }
        }

        // Initialize database service
        const dbService = new DatabaseService();

        // Utility Functions
        function getCurrentWeekDates() {
            const days = [];
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(appState.currentWeekStart);
                date.setDate(appState.currentWeekStart.getDate() + i);
                const dayName = dayNames[date.getDay()];
                const day = date.getDate();
                const month = monthNames[date.getMonth()];
                days.push(`${dayName} ${day}-${month}`);
            }
            return days;
        }

        function getCurrentWeekString() {
            const startDate = new Date(appState.currentWeekStart);
            const endDate = new Date(appState.currentWeekStart);
            endDate.setDate(startDate.getDate() + 6);
            
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const startStr = `${startDate.getDate()}-${monthNames[startDate.getMonth()]}`;
            const endStr = `${endDate.getDate()}-${monthNames[endDate.getMonth()]}`;
            
            return `${startStr} to ${endStr}`;
        }

        function getCurrentWeekKey() {
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const month = monthNames[appState.currentWeekStart.getMonth()];
            const date = appState.currentWeekStart.getDate();
            const year = appState.currentWeekStart.getFullYear();
            return `${month}-${date}-${year}`;
        }

        function getDefaultShift() {
            return {
                employee: '', 
                scheduledStart: '09:00', 
                scheduledEnd: '17:00',
                actualStart: '',
                actualEnd: '',
                leaveType: '',
                leaveHours: 0,
                notes: ''
            };
        }

        function calculateHours(scheduledStart, scheduledEnd, actualStart, actualEnd, day, leaveType, leaveHours = 0, isPublicHoliday = false) {
            // Handle pure leave days (no work)
            if (leaveType && (!actualStart && !actualEnd)) {
                return { 
                    total: 0, 
                    regular: 0, 
                    overtime: 0, 
                    publicHoliday: 0,
                    sundayHours: 0,
                    saturdayHours: 0,
                    annualLeave: leaveType === 'annual' ? (leaveHours || 8) : 0,
                    sickLeave: leaveType === 'sick' ? (leaveHours || 8) : 0,
                    publicHolidayLeave: leaveType === 'public' ? (leaveHours || 8) : 0
                };
            }
            
            const startTime = actualStart || scheduledStart;
            const endTime = actualEnd || scheduledEnd;
            
            if (!startTime || !endTime) {
                return { 
                    total: 0, 
                    regular: 0, 
                    overtime: 0, 
                    publicHoliday: 0,
                    sundayHours: 0,
                    saturdayHours: 0,
                    annualLeave: 0,
                    sickLeave: 0,
                    publicHolidayLeave: 0
                };
            }
            
            const start = new Date(`2024-01-01 ${startTime}`);
            const end = new Date(`2024-01-01 ${endTime}`);
            let totalHours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);
            
            if (totalHours <= 0) {
                return { 
                    total: 0, 
                    regular: 0, 
                    overtime: 0, 
                    publicHoliday: 0,
                    sundayHours: 0,
                    saturdayHours: 0,
                    annualLeave: 0,
                    sickLeave: 0,
                    publicHolidayLeave: 0
                };
            }
            
            // Deduct 30 minutes break time only for shifts over 4 hours (not for overtime)
            let workingHours = totalHours > 4 ? totalHours - 0.5 : totalHours;
            workingHours = Math.max(0, workingHours);
            
            // Initialize leave hours
            let annualLeaveHours = 0;
            let sickLeaveHours = 0;
            let publicHolidayLeaveHours = 0;
            
            // Handle mixed work + leave scenarios
            if (leaveType && leaveHours > 0) {
                if (leaveType === 'annual') {
                    annualLeaveHours = leaveHours;
                } else if (leaveType === 'sick') {
                    sickLeaveHours = leaveHours;
                } else if (leaveType === 'public') {
                    publicHolidayLeaveHours = leaveHours;
                }
            }
            
            // Handle public holiday work (1st priority for 24hrs mandatory)
            if (isPublicHoliday && workingHours > 0) {
                return {
                    total: workingHours,
                    regular: 0,
                    overtime: 0,
                    publicHoliday: workingHours,
                    sundayHours: 0,
                    saturdayHours: 0,
                    annualLeave: annualLeaveHours,
                    sickLeave: sickLeaveHours,
                    publicHolidayLeave: publicHolidayLeaveHours
                };
            }
            
            // Determine day type for 24hrs mandatory priority
            const isSunday = day.includes('Sun');
            const isSaturday = day.includes('Sat');
            
            // Calculate overtime hours (after 6pm - different pay rate)
            const overtimeStart = new Date(`2024-01-01 18:00`); // 6pm
            let regularHours = 0;
            let overtimeHours = 0;
            let sundayHours = 0;
            let saturdayHours = 0;
            
            // Split hours between regular (before 6pm) and overtime (after 6pm)
            if (end.getTime() > overtimeStart.getTime()) {
                // Shift extends past 6pm
                if (start.getTime() >= overtimeStart.getTime()) {
                    // All hours are overtime - no break deduction for overtime
                    overtimeHours = totalHours;
                } else {
                    // Split between regular and overtime
                    const regularWorkTime = (overtimeStart.getTime() - start.getTime()) / (1000 * 60 * 60);
                    const overtimeWorkTime = (end.getTime() - overtimeStart.getTime()) / (1000 * 60 * 60);
                    
                    // Apply break deduction only to regular hours if total shift > 4 hours
                    if (totalHours > 4) {
                        regularHours = Math.max(0, regularWorkTime - 0.5);
                        overtimeHours = overtimeWorkTime; // No break deduction for overtime
                    } else {
                        regularHours = regularWorkTime;
                        overtimeHours = overtimeWorkTime;
                    }
                    workingHours = regularHours + overtimeHours;
                }
            } else {
                // All hours are regular (before 6pm)
                regularHours = workingHours;
            }
            
            // Apply weekend premium rates (24hrs mandatory priority)
            if (isSunday) {
                // Sunday is 2nd priority - all hours get Sunday rate
                sundayHours = workingHours;
                regularHours = 0;
                overtimeHours = 0;
            } else if (isSaturday) {
                // Saturday is 3rd priority - all hours get Saturday rate
                saturdayHours = workingHours;
                regularHours = 0;
                overtimeHours = 0;
            }
            
            return {
                total: workingHours,
                regular: Math.max(0, regularHours),
                overtime: Math.max(0, overtimeHours), // Overtime after 6pm (different pay rate)
                publicHoliday: 0,
                sundayHours: Math.max(0, sundayHours), // 2nd priority for 24hrs mandatory
                saturdayHours: Math.max(0, saturdayHours), // 3rd priority for 24hrs mandatory
                annualLeave: annualLeaveHours,
                sickLeave: sickLeaveHours,
                publicHolidayLeave: publicHolidayLeaveHours
            };
        }

        // Authentication Functions
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Validate credentials using same logic as original React app
            if (appState.appConfig.users[username] && appState.appConfig.users[username] === password) {
                appState.isLoggedIn = true;
                appState.currentUser = username;
                
                // Save credentials if remember password is checked
                if (document.getElementById('rememberPassword').checked) {
                    const credentialsToSave = {
                        username,
                        password,
                        remember: true
                    };
                    sessionStorage.setItem(`${appState.appConfig.locationId}-saved-credentials`, JSON.stringify(credentialsToSave));
                } else {
                    // Clear saved credentials if remember is unchecked
                    sessionStorage.removeItem(`${appState.appConfig.locationId}-saved-credentials`);
                }
                
                showMainApp();
                clearLoginError();
            } else {
                showLoginError('Invalid username or password');
            }
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    errorDiv.classList.add('hidden');
                }, 5000);
            }
        }

        function clearLoginError() {
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.classList.add('hidden');
            }
        }

        function handleLogout() {
            appState.isLoggedIn = false;
            appState.currentUser = '';
            document.getElementById('loginForm').reset();
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUserDisplay').textContent = appState.currentUser;
            loadRosterData();
        }
        
        function loadRememberedLogin() {
            try {
                const savedCredentials = sessionStorage.getItem(`${appState.appConfig.locationId}-saved-credentials`);
                if (savedCredentials) {
                    const { username, password, remember } = JSON.parse(savedCredentials);
                    if (remember) {
                        const usernameField = document.getElementById('username');
                        const passwordField = document.getElementById('password');
                        const rememberCheckbox = document.getElementById('rememberPassword');
                        
                        if (usernameField) usernameField.value = username;
                        if (passwordField) passwordField.value = password;
                        if (rememberCheckbox) rememberCheckbox.checked = true;
                        
                        appState.rememberPassword = true;
                    }
                }
            } catch (error) {
                console.error('Failed to load remembered login:', error);
            }
        }

        // Tab Management
        function switchTab(tabName) {
            // Update active tab state
            appState.activeTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Show correct content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            
            if (tabName === 'roster') {
                renderRosterGrid();
            } else if (tabName === 'employees') {
                renderEmployeesTab();
            } else if (tabName === 'locations') {
                renderLocationsTab();
            } else if (tabName === 'reports') {
                renderReportsTab();
            }
        }

        // Week Navigation
        function navigateWeek(direction) {
            const currentWeek = new Date(appState.currentWeekStart);
            
            if (direction === 'prev') {
                currentWeek.setDate(currentWeek.getDate() - 7);
            } else {
                currentWeek.setDate(currentWeek.getDate() + 7);
            }
            
            appState.currentWeekStart = currentWeek;
            updateWeekDisplay();
            loadRosterData();
        }

        function updateWeekDisplay() {
            const weekString = getCurrentWeekString();
            document.getElementById('currentWeekDisplay').textContent = weekString;
        }

        // Roster Grid Functions
        async function loadRosterData() {
            const weekKey = getCurrentWeekKey();
            try {
                setSyncStatus('syncing');
                const rosterData = await dbService.getRosterData(appState.appConfig.locationId, weekKey);
                
                if (rosterData) {
                    appState.allRosterData[weekKey] = rosterData;
                } else {
                    // Initialize empty roster for the week
                    appState.allRosterData[weekKey] = {};
                    appState.employees.forEach(employee => {
                        appState.allRosterData[weekKey][employee] = {};
                    });
                }
                
                renderRosterGrid();
                setSyncStatus('synced');
            } catch (error) {
                console.error('Failed to load roster data:', error);
                setSyncStatus('offline');
            }
        }

        async function saveRosterData() {
            const weekKey = getCurrentWeekKey();
            try {
                setSyncStatus('syncing');
                const success = await dbService.saveRosterData(
                    appState.appConfig.locationId, 
                    weekKey, 
                    appState.allRosterData[weekKey] || {}
                );
                
                if (success) {
                    setSyncStatus('synced');
                    console.log('‚úÖ Roster data saved successfully');
                } else {
                    setSyncStatus('offline');
                    console.warn('‚ö†Ô∏è Roster data saved locally only');
                }
            } catch (error) {
                console.error('Failed to save roster data:', error);
                setSyncStatus('offline');
            }
        }

        function setSyncStatus(status) {
            appState.syncStatus = status;
            const statusIndicator = document.getElementById('syncStatus');
            const statusText = document.getElementById('syncText');
            
            if (statusIndicator && statusText) {
                statusIndicator.className = `status-indicator status-${status}`;
                
                switch (status) {
                    case 'synced':
                        statusText.textContent = 'Synced';
                        break;
                    case 'syncing':
                        statusText.textContent = 'Syncing...';
                        break;
                    case 'offline':
                        statusText.textContent = 'Offline';
                        break;
                }
            }
        }

        function toggleEditMode() {
            appState.editMode = !appState.editMode;
            
            const editBtn = document.getElementById('editModeBtn');
            const saveBtn = document.getElementById('saveModeBtn');
            const notice = document.getElementById('editModeNotice');
            
            if (appState.editMode) {
                editBtn.classList.add('hidden');
                saveBtn.classList.remove('hidden');
                notice.classList.add('hidden');
                console.log('‚úèÔ∏è Edit mode enabled');
            } else {
                editBtn.classList.remove('hidden');
                saveBtn.classList.add('hidden');
                notice.classList.remove('hidden');
                saveRosterData();
                console.log('üëÅÔ∏è View mode enabled');
            }
            
            renderRosterGrid();
        }

        function renderRosterGrid() {
            const grid = document.getElementById('rosterGrid');
            if (!grid) return;
            
            const weekDays = getCurrentWeekDates();
            const weekKey = getCurrentWeekKey();
            const currentWeekData = appState.allRosterData[weekKey] || {};
            
            // Clear existing grid
            grid.innerHTML = '';
            
            // Add header row - first cell is "Location", then days
            grid.appendChild(createHeaderCell('Location'));
            weekDays.forEach(day => {
                grid.appendChild(createHeaderCell(day));
            });
            
            // Add location rows
            appState.locations.forEach(location => {
                // Location name cell
                grid.appendChild(createLocationNameCell(location));
                
                // Day cells for this location
                weekDays.forEach(day => {
                    grid.appendChild(createLocationDayCell(location, day, currentWeekData));
                });
            });
            
            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
            
            // Update weekly summary table
            renderWeeklySummaryTable();
        }
        
        function renderWeeklySummaryTable() {
            const tableBody = document.getElementById('weeklySummaryTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            appState.employees.forEach((employee, index) => {
                const summary = getWeeklySummary(employee);
                const row = document.createElement('tr');
                row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                
                row.innerHTML = `
                    <td class="p-2 font-medium text-gray-800 border-r">${employee}</td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-blue-100 text-blue-900">
                            ${summary.mondayToFridayRegular.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-orange-100 text-orange-900">
                            ${summary.overtime.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-indigo-100 text-indigo-900">
                            ${summary.saturday.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-purple-100 text-purple-900">
                            ${summary.sunday.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-red-100 text-red-900">
                            ${summary.publicHoliday.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-green-100 text-green-900">
                            ${summary.annualLeave.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-yellow-100 text-yellow-900">
                            ${summary.sickLeave.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-pink-100 text-pink-900">
                            ${summary.publicHolidayLeave.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-cyan-100 text-cyan-900">
                            ${summary.mandatoryHours.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center border-r">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-gray-100 text-gray-900">
                            ${summary.remainingRegularHours.toFixed(1)}
                        </span>
                    </td>
                    <td class="p-2 text-center">
                        <span class="px-2 py-1 rounded text-sm font-bold bg-emerald-100 text-emerald-900">
                            ${summary.total.toFixed(1)}
                        </span>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function createHeaderCell(text) {
            const cell = document.createElement('div');
            cell.className = 'roster-cell header';
            cell.textContent = text;
            return cell;
        }

        function createLocationNameCell(location) {
            const cell = document.createElement('div');
            cell.className = 'roster-cell location-name';
            cell.innerHTML = `
                <div class="font-medium text-gray-900">${location}</div>
            `;
            return cell;
        }

        function createLocationDayCell(location, day, weekData) {
            const cell = document.createElement('div');
            cell.className = 'roster-cell';
            
            // Find employees scheduled for this location and day
            const scheduledEmployees = [];
            
            // Look through all employees to find who's scheduled for this location/day
            appState.employees.forEach(employee => {
                const employeeShifts = weekData[employee]?.[day] || [];
                employeeShifts.forEach(shift => {
                    if (shift.location === location) {
                        scheduledEmployees.push({
                            employee: employee,
                            shift: shift
                        });
                    }
                });
            });
            
            // Add scheduled employees to the cell
            scheduledEmployees.forEach(({ employee, shift }) => {
                const employeeCard = createEmployeeCard(employee, shift, location, day);
                cell.appendChild(employeeCard);
            });
            
            // Add button for adding new employee to this location/day if in edit mode
            if (appState.editMode) {
                const addButton = document.createElement('button');
                addButton.className = 'btn-ghost w-full';
                addButton.style.marginTop = 'auto'; // Push to bottom
                addButton.innerHTML = '<i data-lucide="plus" class="w-4 h-4"></i>';
                addButton.onclick = () => openShiftModal('', day, location, null);
                cell.appendChild(addButton);
            }
            
            return cell;
        }

        function createEmployeeCard(employee, shift, location, day) {
            const card = document.createElement('div');
            card.className = 'shift-card';
            
            // Calculate shift hours using the proper business rules
            const hours = calculateHours(
                shift.scheduledStart,
                shift.scheduledEnd,
                shift.actualStart,
                shift.actualEnd,
                day,
                shift.leaveType,
                shift.leaveHours,
                shift.isPublicHoliday
            );
            
            const totalHours = hours.total;
            const hoursDisplay = totalHours > 0 ? `${totalHours}h` : '';
            
            // Format according to original design: Employee name with time range and hours
            card.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 2px;">${employee}</div>
                <div style="font-size: 0.8rem; opacity: 0.8;">
                    ${shift.scheduledStart || '09:00'} - ${shift.scheduledEnd || '17:00'}
                </div>
                ${hoursDisplay ? `<div style="font-size: 0.75rem; color: #6B7280; margin-top: 2px; font-weight: 500;">${hoursDisplay}</div>` : ''}
            `;
            
            if (appState.editMode) {
                card.onclick = () => openShiftModal(employee, day, location, shift);
            }
            
            return card;
        }

        function getLeaveTypeColor(leaveType) {
            switch (leaveType) {
                case 'annual': return 'var(--success)';
                case 'sick': return 'var(--warning)';
                case 'public': return 'var(--primary)';
                default: return 'var(--muted)';
            }
        }

        function getLeaveTypeDisplay(leaveType) {
            switch (leaveType) {
                case 'annual': return 'Annual Leave';
                case 'sick': return 'Sick Leave';
                case 'public': return 'Public Holiday';
                default: return 'Leave';
            }
        }

        // Modal Functions
        function openShiftModal(employee, day, location, shift) {
            appState.currentEditingShift = { employee, day, location, shift };
            
            // Populate form
            populateShiftModal(shift);
            
            // Show modal
            document.getElementById('shiftModal').classList.remove('hidden');
            
            console.log(`üîß Opened shift modal for: ${employee || 'New Employee'} at ${location} on ${day}`);
        }

        function closeShiftModal() {
            document.getElementById('shiftModal').classList.add('hidden');
            appState.currentEditingShift = null;
        }

        function populateShiftModal(shift) {
            const employeeSelect = document.getElementById('shiftEmployee');
            const locationSelect = document.getElementById('shiftLocation');
            
            // Get current editing context
            const { employee: currentEmployee, location: currentLocation } = appState.currentEditingShift || {};
            
            // Populate employee options
            employeeSelect.innerHTML = '';
            appState.employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp;
                option.textContent = emp;
                // Select current employee or the one from existing shift
                if ((shift && shift.employee === emp) || (!shift && currentEmployee === emp)) {
                    option.selected = true;
                }
                employeeSelect.appendChild(option);
            });
            
            // Populate location options
            locationSelect.innerHTML = '';
            appState.locations.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc;
                option.textContent = loc;
                // Select current location or the one from existing shift
                if ((shift && shift.location === loc) || (!shift && currentLocation === loc)) {
                    option.selected = true;
                }
                locationSelect.appendChild(option);
            });
            
            // Set form values
            document.getElementById('shiftStartTime').value = shift?.scheduledStart || '09:00';
            document.getElementById('shiftEndTime').value = shift?.scheduledEnd || '17:00';
            document.getElementById('shiftLeaveType').value = shift?.leaveType || '';
            document.getElementById('shiftNotes').value = shift?.notes || '';
        }

        function handleShiftFormSubmit(event) {
            event.preventDefault();
            
            if (!appState.currentEditingShift) return;
            
            const selectedEmployee = document.getElementById('shiftEmployee').value;
            const selectedLocation = document.getElementById('shiftLocation').value;
            
            const formData = {
                employee: selectedEmployee,
                location: selectedLocation,
                scheduledStart: document.getElementById('shiftStartTime').value,
                scheduledEnd: document.getElementById('shiftEndTime').value,
                leaveType: document.getElementById('shiftLeaveType').value,
                notes: document.getElementById('shiftNotes').value,
                actualStart: '',
                actualEnd: '',
                leaveHours: 0
            };
            
            // Save to roster data using the selected employee (not the old one)
            const { day } = appState.currentEditingShift;
            const weekKey = getCurrentWeekKey();
            
            if (!appState.allRosterData[weekKey]) {
                appState.allRosterData[weekKey] = {};
            }
            if (!appState.allRosterData[weekKey][selectedEmployee]) {
                appState.allRosterData[weekKey][selectedEmployee] = {};
            }
            if (!appState.allRosterData[weekKey][selectedEmployee][day]) {
                appState.allRosterData[weekKey][selectedEmployee][day] = [];
            }
            
            // Add or update shift
            const existingShiftIndex = appState.allRosterData[weekKey][selectedEmployee][day].findIndex(
                s => s === appState.currentEditingShift.shift
            );
            
            if (existingShiftIndex >= 0) {
                appState.allRosterData[weekKey][selectedEmployee][day][existingShiftIndex] = formData;
            } else {
                appState.allRosterData[weekKey][selectedEmployee][day].push(formData);
            }
            
            closeShiftModal();
            renderRosterGrid();
            saveRosterData();
            
            console.log(`‚úÖ Shift saved: ${selectedEmployee} at ${selectedLocation} on ${day}`);
        }

        function deleteShift() {
            if (!appState.currentEditingShift) return;
            
            const { day, employee } = appState.currentEditingShift;
            const weekKey = getCurrentWeekKey();
            
            if (appState.allRosterData[weekKey]?.[employee]?.[day]) {
                const shiftIndex = appState.allRosterData[weekKey][employee][day].findIndex(
                    s => s === appState.currentEditingShift.shift
                );
                
                if (shiftIndex >= 0) {
                    appState.allRosterData[weekKey][employee][day].splice(shiftIndex, 1);
                }
            }
            
            closeShiftModal();
            renderRosterGrid();
            saveRosterData();
        }

        // Employee Management Functions
        function renderEmployeesTab() {
            const container = document.getElementById('employeesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            appState.employees.forEach(employee => {
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-lg shadow-sm border';
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-gray-900">${employee}</h3>
                            <p class="text-sm text-gray-500">Active Employee</p>
                        </div>
                        <button onclick="editEmployee('${employee}')" class="btn-ghost">
                            <i data-lucide="edit" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Status:</span>
                            <span class="ml-2 text-success">Active</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Shifts:</span>
                            <span class="ml-2">Available</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function editEmployee(employee) {
            // Implementation for employee editing
            console.log('Edit employee:', employee);
        }

        // Location Management Functions
        function renderLocationsTab() {
            const container = document.getElementById('locationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            appState.locations.forEach(location => {
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-lg shadow-sm border';
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-gray-900">${location}</h3>
                            <p class="text-sm text-gray-500">Active Location</p>
                        </div>
                        <button onclick="editLocation('${location}')" class="btn-ghost">
                            <i data-lucide="edit" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Status:</span>
                            <span class="ml-2 text-success">Operational</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Staff:</span>
                            <span class="ml-2">${Math.floor(Math.random() * 5) + 1}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function editLocation(location) {
            // Implementation for location editing
            console.log('Edit location:', location);
        }

        // Reports Functions
        function renderReportsTab() {
            generatePayRateReport();
            
            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        }
        
        function generatePayRateReport() {
            const tableBody = document.getElementById('payRateTableBody');
            if (!tableBody) return;
            
            const weekKey = getCurrentWeekKey();
            const weekData = appState.allRosterData[weekKey] || {};
            const weekDays = getCurrentWeekDates();
            
            // Clear existing content
            tableBody.innerHTML = '';
            
            // Calculate data for each employee
            appState.employees.forEach(employee => {
                const employeeData = weekData[employee] || {};
                const payRateBreakdown = calculateEmployeePayRates(employeeData, weekDays);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-200 px-3 py-2 font-medium">${employee}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-blue-600">${payRateBreakdown.regular}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-red-600">${payRateBreakdown.overtime}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-blue-600">${payRateBreakdown.saturday}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-purple-600">${payRateBreakdown.sunday}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-red-600">${payRateBreakdown.phWork}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-green-600">${payRateBreakdown.annualLeave}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-yellow-600">${payRateBreakdown.sickLeave}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-pink-600">${payRateBreakdown.publicHolidayLeave}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-cyan-600">${payRateBreakdown.mandatory}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-gray-600">${payRateBreakdown.remainingReg}</td>
                    <td class="border border-gray-200 px-3 py-2 text-center text-green-700 font-bold">${payRateBreakdown.total}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function calculateEmployeePayRates(employeeData, weekDays) {
            let regular = 0;
            let overtime = 0;
            let saturday = 0;
            let sunday = 0;
            let phWork = 0;
            let annualLeave = 0;
            let sickLeave = 0;
            let publicHolidayLeave = 0;
            let mandatory = 0;
            
            // Days of week mapping
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            weekDays.forEach((displayDay, index) => {
                const shifts = employeeData[displayDay] || [];
                const dayOfWeek = index; // 0 = Sunday, 6 = Saturday
                
                shifts.forEach(shift => {
                    const hours = calculateDetailedHours(shift, dayOfWeek);
                    
                    // Add hours to appropriate categories
                    regular += hours.regular;
                    overtime += hours.overtime;
                    saturday += hours.saturday;
                    sunday += hours.sunday;
                    phWork += hours.publicHoliday;
                    annualLeave += hours.annualLeave;
                    sickLeave += hours.sickLeave;
                    publicHolidayLeave += hours.publicHolidayLeave;
                });
            });
            
            // Calculate mandatory (24h per week standard)
            const totalWorkedHours = regular + overtime + saturday + sunday + phWork;
            mandatory = Math.min(totalWorkedHours, 24);
            
            // Calculate remaining regular hours
            const remainingReg = Math.max(0, regular - mandatory);
            
            // Calculate total
            const total = regular + overtime + saturday + sunday + phWork + annualLeave + sickLeave + publicHolidayLeave;
            
            return {
                regular: regular.toFixed(1),
                overtime: overtime.toFixed(1),
                saturday: saturday.toFixed(1),
                sunday: sunday.toFixed(1),
                phWork: phWork.toFixed(1),
                annualLeave: annualLeave.toFixed(1),
                sickLeave: sickLeave.toFixed(1),
                publicHolidayLeave: publicHolidayLeave.toFixed(1),
                mandatory: mandatory.toFixed(1),
                remainingReg: remainingReg.toFixed(1),
                total: total.toFixed(1)
            };
        }
        
        function calculateDetailedHours(shift, dayOfWeek) {
            const result = {
                regular: 0,
                overtime: 0,
                saturday: 0,
                sunday: 0,
                publicHoliday: 0,
                annualLeave: 0,
                sickLeave: 0,
                publicHolidayLeave: 0
            };
            
            // Handle leave types
            if (shift.leaveType) {
                const leaveHours = shift.leaveHours || 8;
                switch (shift.leaveType) {
                    case 'annual':
                        result.annualLeave = leaveHours;
                        break;
                    case 'sick':
                        result.sickLeave = leaveHours;
                        break;
                    case 'public':
                        result.publicHolidayLeave = leaveHours;
                        break;
                }
                return result;
            }
            
            // Calculate worked hours
            const startTime = shift.actualStart || shift.scheduledStart || '09:00';
            const endTime = shift.actualEnd || shift.scheduledEnd || '17:00';
            
            if (!startTime || !endTime) return result;
            
            const start = new Date(`2024-01-01 ${startTime}`);
            const end = new Date(`2024-01-01 ${endTime}`);
            let totalHours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);
            
            if (totalHours <= 0) return result;
            
            // Classify hours based on day of week
            if (dayOfWeek === 0) { // Sunday
                result.sunday = totalHours;
            } else if (dayOfWeek === 6) { // Saturday
                result.saturday = totalHours;
            } else { // Monday to Friday
                if (totalHours <= 8) {
                    result.regular = totalHours;
                } else {
                    result.regular = 8;
                    result.overtime = totalHours - 8;
                }
            }
            
            return result;
        }
        
        function exportReport() {
            const weekKey = getCurrentWeekKey();
            const weekString = getCurrentWeekString();
            
            // Create CSV content
            let csvContent = `Hours Summary by Pay Rate - Week ${weekString}\n`;
            csvContent += 'Employee,Regular,Overtime,Saturday,Sunday,PH Work,AL,SL,PHL,Mandatory (24h),Remaining Reg,Total\n';
            
            appState.employees.forEach(employee => {
                const employeeData = appState.allRosterData[weekKey]?.[employee] || {};
                const weekDays = getCurrentWeekDates();
                const payRateBreakdown = calculateEmployeePayRates(employeeData, weekDays);
                
                csvContent += `${employee},${payRateBreakdown.regular},${payRateBreakdown.overtime},${payRateBreakdown.saturday},${payRateBreakdown.sunday},${payRateBreakdown.phWork},${payRateBreakdown.annualLeave},${payRateBreakdown.sickLeave},${payRateBreakdown.publicHolidayLeave},${payRateBreakdown.mandatory},${payRateBreakdown.remainingReg},${payRateBreakdown.total}\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hours-summary-${weekKey}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function convertTo12Hour(time24) {
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours, 10);
            const ampm = hour >= 12 ? 'pm' : 'am';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes}${ampm}`;
        }

        function downloadPreviousWeek() {
            // Navigate to previous week and generate report
            navigateWeek('prev');
            setTimeout(() => {
                downloadCombinedRoster();
            }, 500);
        }
        
        function downloadCombinedRoster() {
            const weekKey = getCurrentWeekKey();
            const weekString = getCurrentWeekString();
            const weekData = appState.allRosterData[weekKey] || {};
            const weekDays = getCurrentWeekDates();
            const today = new Date();
            const timeString = today.toLocaleTimeString('en-AU', { 
                hour12: true, 
                hour: 'numeric', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            const dateString = today.toLocaleDateString('en-AU', {
                day: 'numeric',
                month: 'numeric',
                year: 'numeric'
            });
            
            // Create HTML content matching the original format exactly
            let htmlContent = `<!DOCTYPE html>
<html>
<head>
    <title>Shriajj_Combined_Roster_${weekString.replace(/\s+/g, '_').replace(/,/g, '')}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .company-name { font-size: 18px; font-weight: bold; color: #4285f4; }
        .roster-title { font-size: 14px; margin: 5px 0; }
        .generated { font-size: 12px; color: #666; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
        th { background-color: #f5f5f5; font-weight: bold; text-align: center; }
        .location-cell { font-weight: bold; background-color: #f9f9f9; }
        .employee-cell { font-size: 12px; }
        .legend { margin-top: 20px; font-size: 12px; }
        .footer { margin-top: 20px; font-size: 11px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <div class="company-name">SHRIAJJ PTY LTD</div>
        <div class="roster-title">Weekly Combined Roster: ${weekString}</div>
        <div class="generated">Generated on ${dateString} at ${timeString}</div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Location</th>`;
            htmlContent += ``;
            
            // Add header columns with proper day formatting
            weekDays.forEach(day => {
                const parts = day.split(' ');
                const dayHeader = `${parts[1]}-${parts[0]}`;  // Format as "3-Aug", "4-Aug", etc.
                const date = new Date(day + ', 2025');
                const dayName = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][date.getDay()];
                htmlContent += `<th>${dayHeader}<br>${dayName}</th>`;
            });
            
            htmlContent += `</tr>
        </thead>
        <tbody>`;
            
            // Process each location - create HTML table rows
            appState.locations.forEach((location, locationIndex) => {
                // Find all employees working at this location this week
                const locationEmployees = new Set();
                weekDays.forEach(day => {
                    appState.employees.forEach(employee => {
                        const employeeShifts = weekData[employee]?.[day] || [];
                        if (employeeShifts.some(shift => shift.location === location)) {
                            locationEmployees.add(employee);
                        }
                    });
                });
                
                // Sort employees alphabetically for consistent display
                const sortedEmployees = Array.from(locationEmployees).sort();
                
                // If no employees, create one empty row
                if (sortedEmployees.length === 0) {
                    htmlContent += `<tr><td class="location-cell">${location}</td>`;
                    weekDays.forEach(() => {
                        htmlContent += '<td>-</td>';
                    });
                    htmlContent += '</tr>';
                    return;
                }
                
                // Create one row per employee for this location
                sortedEmployees.forEach((employee, empIndex) => {
                    htmlContent += '<tr>';
                    
                    // Location name only on first employee row
                    if (empIndex === 0) {
                        htmlContent += `<td class="location-cell" rowspan="${sortedEmployees.length}">${location}</td>`;
                    }
                    
                    // Add employee data for each day
                    weekDays.forEach(day => {
                        const employeeShifts = weekData[employee]?.[day] || [];
                        const locationShift = employeeShifts.find(shift => shift.location === location);
                        
                        if (locationShift) {
                            const startTime = locationShift.scheduledStart || '09:00';
                            const endTime = locationShift.scheduledEnd || '17:00';
                            const start12hr = convertTo12Hour(startTime);
                            const end12hr = convertTo12Hour(endTime);
                            
                            htmlContent += `<td class="employee-cell">
                                <strong>${employee}</strong><br>
                                Scheduled: ${start12hr} - ${end12hr}
                            </td>`;
                        } else {
                            htmlContent += '<td></td>';
                        }
                    });
                    
                    htmlContent += '</tr>';
                });
            });
            
            htmlContent += `
        </tbody>
    </table>
    
    <div class="legend">
        <strong>Legend:</strong> Scheduled | Actual | Annual Leave (AL) | Sick Leave (SL) | Public Holiday (PH) | Notes<br>
        Public holidays are highlighted in pink background
    </div>
    
    <div class="footer">
        ¬© ${today.getFullYear()} Shriajj Pty Ltd - Weekly Combined Roster | Generated from Staff Roster Management System<br>
        App designed and developed by Vrushali Hinge
    </div>
</body>
</html>`;
            
            // Create and download HTML file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Shriajj_Combined_Roster_${weekString.replace(/\s+/g, '_').replace(/,/g, '')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            console.log('üì• Combined roster downloaded successfully');
        }
        
        function exportForEmployees() {
            const weekKey = getCurrentWeekKey();
            const weekString = getCurrentWeekString();
            const weekData = appState.allRosterData[weekKey] || {};
            const weekDays = getCurrentWeekDates();
            
            // Create employee-friendly CSV content
            let csvContent = `Employee Roster - Week ${weekString}\n\n`;
            csvContent += 'Employee,Day,Location,Start Time,End Time,Hours,Notes\n';
            
            // Organize by employee
            appState.employees.forEach(employee => {
                const employeeData = weekData[employee] || {};
                weekDays.forEach(day => {
                    const shifts = employeeData[day] || [];
                    if (shifts.length === 0) {
                        csvContent += `${employee},${day},,,,0,Day Off\n`;
                    } else {
                        shifts.forEach(shift => {
                            const startTime = shift.scheduledStart || '09:00';
                            const endTime = shift.scheduledEnd || '17:00';
                            const hours = calculateShiftHours(startTime, endTime);
                            const notes = shift.notes || '';
                            csvContent += `${employee},${day},${shift.location || ''},${startTime},${endTime},${hours},"${notes}"\n`;
                        });
                    }
                });
                csvContent += '\n'; // Add blank line between employees
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `employee-roster-${weekKey}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function calculateShiftHours(startTime, endTime) {
            if (!startTime || !endTime) return 0;
            
            const start = new Date(`2024-01-01 ${startTime}`);
            const end = new Date(`2024-01-01 ${endTime}`);
            let hours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);
            
            // Deduct 30 minutes break time only for shifts over 4 hours
            if (hours > 4) {
                hours -= 0.5;
            }
            
            return Math.max(0, Math.round(hours * 2) / 2); // Round to nearest 0.5
        }

        function getDailyHours(employee, day) {
            const weekKey = getCurrentWeekKey();
            const weekData = appState.allRosterData[weekKey] || {};
            const employeeData = weekData[employee] || {};
            const dayShifts = employeeData[day] || [];
            
            let regular = 0;
            let overtime = 0;
            let publicHoliday = 0;
            let sundayHours = 0;
            let saturdayHours = 0;
            let annualLeave = 0;
            let sickLeave = 0;
            let publicHolidayLeave = 0;
            let total = 0;
            
            dayShifts.forEach(shift => {
                const hours = calculateHours(
                    shift.scheduledStart,
                    shift.scheduledEnd,
                    shift.actualStart,
                    shift.actualEnd,
                    day,
                    shift.leaveType,
                    shift.leaveHours,
                    shift.isPublicHoliday
                );
                
                regular += hours.regular;
                overtime += hours.overtime; // After 6pm
                publicHoliday += hours.publicHoliday; // 1st priority
                sundayHours += hours.sundayHours; // 2nd priority  
                saturdayHours += hours.saturdayHours; // 3rd priority
                annualLeave += hours.annualLeave;
                sickLeave += hours.sickLeave;
                publicHolidayLeave += hours.publicHolidayLeave;
                total += hours.total;
            });
            
            // Add leave hours to total
            total += annualLeave + sickLeave + publicHolidayLeave;
            
            return {
                regular,
                overtime, // After 6pm (different pay rate)
                publicHoliday, // 1st priority for 24hrs mandatory
                sundayHours, // 2nd priority for 24hrs mandatory
                saturdayHours, // 3rd priority for 24hrs mandatory
                annualLeave,
                sickLeave,
                publicHolidayLeave,
                total
            };
        }

        function getWeeklySummary(employee) {
            const weekKey = getCurrentWeekKey();
            const weekData = appState.allRosterData[weekKey] || {};
            const employeeData = weekData[employee] || {};
            const weekDays = getCurrentWeekDates();
            
            let mondayToFridayRegular = 0;
            let overtimeTotal = 0; // After 6pm (different pay rate)
            let saturdayTotal = 0; // 3rd priority for 24hrs mandatory
            let sundayTotal = 0; // 2nd priority for 24hrs mandatory  
            let publicHolidayTotal = 0; // 1st priority for 24hrs mandatory
            let annualLeaveTotal = 0;
            let sickLeaveTotal = 0;
            let publicHolidayLeaveTotal = 0;
            let totalHours = 0;

            weekDays.forEach(day => {
                const dayHours = getDailyHours(employee, day);
                totalHours += dayHours.total;
                
                // Collect different hour types based on priority rules
                mondayToFridayRegular += dayHours.regular;
                overtimeTotal += dayHours.overtime; // After 6pm
                saturdayTotal += dayHours.saturdayHours; // Saturday hours
                sundayTotal += dayHours.sundayHours; // Sunday hours  
                publicHolidayTotal += dayHours.publicHoliday; // Public holiday
                
                // Leave hours
                annualLeaveTotal += dayHours.annualLeave;
                sickLeaveTotal += dayHours.sickLeave;
                publicHolidayLeaveTotal += dayHours.publicHolidayLeave;
            });

            // 24hrs mandatory calculation with priority:
            // 1st priority: Public holidays
            // 2nd priority: Sunday  
            // 3rd priority: Saturday
            // 4th priority: Overtime (after 6pm)
            // 5th priority: Regular hours (fill to reach 24hrs)
            const mandatoryCategories = publicHolidayTotal + sundayTotal + saturdayTotal + overtimeTotal;
            const mandatoryFromRegular = Math.min(mondayToFridayRegular, Math.max(0, 24 - mandatoryCategories));
            const totalMandatory = mandatoryCategories + mandatoryFromRegular;
            const remainingRegularHours = Math.max(0, mondayToFridayRegular - mandatoryFromRegular);
            const calculatedTotal = totalMandatory + remainingRegularHours;

            return {
                mondayToFridayRegular,
                overtime: overtimeTotal, // After 6pm (different pay rate)
                saturday: saturdayTotal, // 3rd priority for 24hrs mandatory
                sunday: sundayTotal, // 2nd priority for 24hrs mandatory
                publicHoliday: publicHolidayTotal, // 1st priority for 24hrs mandatory
                annualLeave: annualLeaveTotal,
                sickLeave: sickLeaveTotal,
                publicHolidayLeave: publicHolidayLeaveTotal,
                mandatoryHours: totalMandatory,
                remainingRegularHours: remainingRegularHours,
                total: calculatedTotal
            };
        }

        function calculateTotalShifts(weekData) {
            let total = 0;
            Object.values(weekData).forEach(employee => {
                Object.values(employee).forEach(day => {
                    total += day.length;
                });
            });
            return total;
        }

        function calculateTotalHours(weekData) {
            let total = 0;
            Object.values(weekData).forEach(employee => {
                Object.entries(employee).forEach(([day, shifts]) => {
                    shifts.forEach(shift => {
                        const hours = calculateHours(
                            shift.scheduledStart,
                            shift.scheduledEnd,
                            shift.actualStart,
                            shift.actualEnd,
                            day,
                            shift.leaveType,
                            shift.leaveHours
                        );
                        total += hours.total;
                    });
                });
            });
            return Math.round(total * 10) / 10;
        }

        function generateEmployeeReports(weekData) {
            return Object.entries(weekData).map(([employee, days]) => {
                const shifts = Object.values(days).flat();
                const totalHours = shifts.reduce((sum, shift) => {
                    const hours = calculateHours(
                        shift.scheduledStart,
                        shift.scheduledEnd,
                        shift.actualStart,
                        shift.actualEnd,
                        '',
                        shift.leaveType,
                        shift.leaveHours
                    );
                    return sum + hours.total;
                }, 0);
                
                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                        <span class="font-medium">${employee}</span>
                        <div class="text-sm text-gray-600">
                            <span class="mr-4">${shifts.length} shifts</span>
                            <span>${Math.round(totalHours * 10) / 10}h</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Connection Status Management
        function updateConnectionStatus() {
            const isConnected = dbService.getConnectionStatus();
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            if (statusIndicator && statusText) {
                if (isConnected) {
                    statusIndicator.className = 'status-indicator status-online';
                    statusText.textContent = 'Connected';
                } else {
                    statusIndicator.className = 'status-indicator status-offline';
                    statusText.textContent = 'Offline Mode';
                }
            }
        }

        // Initialize Application
        async function initializeApp() {
            console.log('üöÄ Initializing Staff Roster Management System...');
            
            // Set up event listeners first (including login form)
            setupEventListeners();
            
            // Load database configuration from server first
            await loadDatabaseConfig();
            
            // Initialize database connection
            try {
                await dbService.initialize(DATABASE_CONFIG);
                updateConnectionStatus();
            } catch (error) {
                console.error('Database initialization failed:', error);
                updateConnectionStatus();
            }
            
            // Load saved authentication if remembered
            loadRememberedLogin();
            
            // Initialize sample data if none exists
            initializeSampleData();
            
            // Update week display
            updateWeekDisplay();
            
            // Initialize Lucide icons (this will handle both login and main app icons)
            if (window.lucide) {
                lucide.createIcons();
            }
            
            console.log('‚úÖ Application initialized successfully!');
        }

        function setupEventListeners() {
            // Authentication
            const loginForm = document.getElementById('loginForm');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Password toggle - with better error handling
            const togglePasswordBtn = document.getElementById('togglePassword');
            if (togglePasswordBtn) {
                togglePasswordBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const passwordInput = document.getElementById('password');
                    const icon = document.querySelector('#togglePassword i');
                    
                    console.log('Password toggle clicked', { passwordInput, icon });
                    
                    if (passwordInput && icon) {
                        if (passwordInput.type === 'password') {
                            passwordInput.type = 'text';
                            icon.setAttribute('data-lucide', 'eye');
                            appState.showPassword = true;
                        } else {
                            passwordInput.type = 'password';
                            icon.setAttribute('data-lucide', 'eye-off');
                            appState.showPassword = false;
                        }
                        
                        // Refresh Lucide icons
                        if (window.lucide) {
                            lucide.createIcons();
                        }
                    }
                });
            } else {
                console.error('Toggle password button not found');
            }
            
            // Remember password checkbox
            const rememberCheckbox = document.getElementById('rememberPassword');
            if (rememberCheckbox) {
                rememberCheckbox.addEventListener('change', (e) => {
                    appState.rememberPassword = e.target.checked;
                    console.log('Remember password changed:', e.target.checked);
                });
            } else {
                console.error('Remember password checkbox not found');
            }
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.dataset.tab);
                });
            });
            
            // Week navigation
            document.getElementById('prevWeek').addEventListener('click', () => navigateWeek('prev'));
            document.getElementById('nextWeek').addEventListener('click', () => navigateWeek('next'));
            
            // Edit mode
            document.getElementById('editModeBtn').addEventListener('click', toggleEditMode);
            document.getElementById('saveModeBtn').addEventListener('click', toggleEditMode);
            
            // Action buttons
            document.getElementById('previousWeekBtn').addEventListener('click', downloadPreviousWeek);
            document.getElementById('downloadCombinedBtn').addEventListener('click', downloadCombinedRoster);
            document.getElementById('exportEmployeesBtn').addEventListener('click', exportForEmployees);
            
            // Modal management
            document.getElementById('closeModal').addEventListener('click', closeShiftModal);
            document.getElementById('shiftForm').addEventListener('submit', handleShiftFormSubmit);
            document.getElementById('deleteShift').addEventListener('click', deleteShift);
            
            // Close modal when clicking outside
            document.getElementById('shiftModal').addEventListener('click', (e) => {
                if (e.target.id === 'shiftModal') {
                    closeShiftModal();
                }
            });
            
            // Online/offline detection
            window.addEventListener('online', () => {
                appState.isOnline = true;
                updateConnectionStatus();
                dbService.syncOfflineChanges();
            });
            
            window.addEventListener('offline', () => {
                appState.isOnline = false;
                updateConnectionStatus();
            });
            
            // Reports buttons
            document.getElementById('exportReport').addEventListener('click', exportReport);
            document.getElementById('refreshReport').addEventListener('click', () => {
                renderReportsTab();
            });
            
            // Real-time data updates
            dbService.onDataChange((change) => {
                console.log('Real-time update received:', change);
                if (change.type === 'roster_updated') {
                    loadRosterData();
                }
            });
        }

        function loadRememberedLogin() {
            const rememberedUsername = localStorage.getItem('rememberedUsername');
            const rememberedPassword = localStorage.getItem('rememberedPassword');
            
            if (rememberedUsername && rememberedPassword) {
                document.getElementById('username').value = rememberedUsername;
                document.getElementById('password').value = rememberedPassword;
                document.getElementById('rememberPassword').checked = true;
            }
        }
        
        function initializeSampleData() {
            const weekKey = getCurrentWeekKey();
            
            // Always replace with the complete roster data from the image
            appState.allRosterData[weekKey] = {
                'Bhanush': {
                    'Sun 3-Aug': [{ scheduledStart: '10:00', scheduledEnd: '17:00', location: 'Caroline Springs', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Tue 5-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Woodgrove', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [{ scheduledStart: '09:00', scheduledEnd: '20:00', location: 'Woodgrove', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '09:00', scheduledEnd: '20:00', location: 'Woodgrove', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:00', location: 'Geelong', employee: 'Bhanush', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Girish': {
                    'Mon 4-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Girish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Girish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Girish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Girish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Girish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Aravind': {
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Caroline Springs', employee: 'Aravind', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '11:00', scheduledEnd: '20:00', location: 'Caroline Springs', employee: 'Aravind', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Vansh': {
                    'Sun 3-Aug': [{ scheduledStart: '12:00', scheduledEnd: '17:00', location: 'Werribee Plaza', employee: 'Vansh', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '11:00', scheduledEnd: '17:30', location: 'Werribee Plaza', employee: 'Vansh', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [{ scheduledStart: '11:00', scheduledEnd: '17:30', location: 'Werribee Plaza', employee: 'Vansh', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '11:00', scheduledEnd: '17:30', location: 'Woodgrove', employee: 'Vansh', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '12:00', scheduledEnd: '17:00', location: 'Caroline Springs', employee: 'Vansh', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Kashish': {
                    'Sun 3-Aug': [{ scheduledStart: '10:00', scheduledEnd: '17:00', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Mon 4-Aug': [{ scheduledStart: '09:15', scheduledEnd: '17:30', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Tue 5-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '12:00', scheduledEnd: '20:00', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '09:20', scheduledEnd: '17:00', location: 'Werribee Plaza', employee: 'Kashish', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Sonam': {
                    'Mon 4-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Point Cook', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Point Cook', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [
                        { scheduledStart: '09:00', scheduledEnd: '20:00', location: 'Werribee Plaza', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 },
                        { scheduledStart: '09:00', scheduledEnd: '19:00', location: 'Point Cook', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }
                    ],
                    'Fri 8-Aug': [{ scheduledStart: '09:00', scheduledEnd: '19:00', location: 'Point Cook', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [
                        { scheduledStart: '12:00', scheduledEnd: '17:00', location: 'Werribee Plaza', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 },
                        { scheduledStart: '09:00', scheduledEnd: '17:00', location: 'Point Cook', employee: 'Sonam', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }
                    ]
                },
                'Tejal': {
                    'Sun 3-Aug': [{ scheduledStart: '10:00', scheduledEnd: '17:00', location: 'Point Cook', employee: 'Tejal', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Tue 5-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Point Cook', employee: 'Tejal', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [{ scheduledStart: '09:00', scheduledEnd: '19:00', location: 'Point Cook', employee: 'Tejal', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '09:00', scheduledEnd: '16:00', location: 'Werribee Plaza', employee: 'Tejal', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:00', location: 'Point Cook', employee: 'Tejal', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Anshul': {
                    'Sun 3-Aug': [{ scheduledStart: '10:00', scheduledEnd: '17:00', location: 'Geelong', employee: 'Anshul', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Tue 5-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Geelong', employee: 'Anshul', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Fri 8-Aug': [{ scheduledStart: '09:00', scheduledEnd: '20:00', location: 'Geelong', employee: 'Anshul', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Matt': {
                    'Mon 4-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Geelong', employee: 'Matt', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Wed 6-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Geelong', employee: 'Matt', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Thu 7-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Geelong', employee: 'Matt', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                },
                'Aswin': {
                    'Sun 3-Aug': [{ scheduledStart: '10:00', scheduledEnd: '17:00', location: 'Woodgrove', employee: 'Aswin', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Mon 4-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Woodgrove', employee: 'Aswin', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Tue 5-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Woodgrove', employee: 'Aswin', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }],
                    'Sat 9-Aug': [{ scheduledStart: '09:00', scheduledEnd: '17:30', location: 'Woodgrove', employee: 'Aswin', actualStart: '', actualEnd: '', leaveType: '', notes: '', leaveHours: 0 }]
                }
            };
            
            // Save to localStorage as backup
            localStorage.setItem('roster-cache', JSON.stringify({ [weekKey]: appState.allRosterData[weekKey] }));
            
            // Update employee list to include all employees
            const newEmployees = ['Bhanush', 'Girish', 'Aravind', 'Vansh', 'Kashish', 'Sonam', 'Tejal', 'Anshul', 'Matt', 'Aswin'];
            appState.employees = [...newEmployees];
            
            console.log('‚úÖ Complete roster data loaded with', Object.keys(appState.allRosterData[weekKey]).length, 'employees and all shifts from image');
            
            // Force save the complete data to database immediately
            saveRosterData();
        }

        // Start the application when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setTimeout(() => {
                initializeSampleData();
                renderRosterGrid();
            }, 1000); // Wait for initialization to complete
        });

        // Global functions for onclick handlers
        window.openShiftModal = openShiftModal;
        window.editEmployee = editEmployee;
        window.editLocation = editLocation;
    </script>
</body>
</html>